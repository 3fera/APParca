<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=320, initial-scale=1">
	<title>Park and Click</title>ss
	<meta name="layout" content="mobile"/>
	
	
	<script src="./assets/js/cordova-1.8.1.js"></script>
<!--	<script src="./assets/js/phonegap-status-bar-notification.js"></script>-->
	
	<link rel="stylesheet" href="./assets/css/jquery.mobile-1.1.0.css" />
	<script src="./assets/js/jquery-1.7.1.min.js"></script>
	<script src="./assets/js/jquery.mobile-1.1.0.js"></script>
	<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
	
	
 
	<link href='./assets/css/style.css' rel='stylesheet' type='text/css' />  


<script type="text/javascript" charset="utf-8">
	var accuracy=0;
	var lat=0;
	var lng=0;
	var globales=Array();
	var marker;
	// Wait for PhoneGap to load
	//
	document.addEventListener("deviceready", onDeviceReady, false);
	$(document).ready(function() {
			reloadEvents();	           		   	
	   });
   // PhoneGap is ready
   //
   
   function onDeviceReady() {
   		//navigator.geolocation.getCurrentPosition(onSuccess, onError);
   		
   		console.log("Dispositivo preparado");
        if(navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position){
				initialize(position.coords.latitude,position.coords.longitude, position.coords.accuracy);
			});
		}else {
			console.log("problema con la geolocalizacion");
			alert2("No hemos podido localizar su posiciÃ³n.");
			
		}

    }
      // onSuccess Geolocation
    //
    var map;
    var fechaServidor=null;
    var accuracy_min=80;
    
   
    	

	

	
	var circle;
	
    function initialize(lat,lng,accuracy) {
    	console.log("Inicializamos todo el mapa");
		/*globales['lat']="41.795232";
    	globales['lng']="3.042054";*/
    	globales['lat']=lat;
    	globales['lng']=lng;
    	globales['accuracy']=accuracy;
		var latlng = new google.maps.LatLng(lat, lng);
		var myOptions = {
			zoom: 18,
			center: latlng,
			panControl: false,
		    zoomControl: true,
		    scaleControl: true,
		    streetViewControl: false,
		    mapTypeControl: false,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		};
	    map = new google.maps.Map(document.getElementById("map_canvas"),myOptions);
	    
	    marker = new google.maps.Marker({
			position: latlng, 
			map: map
		});
				
	   circle = new google.maps.Circle({
			    center: latlng,
			    radius: globales['accuracy'],
			    map: map, //your map,
			    fillColor: 'blue', //color,
			    fillOpacity: 0.2, //opacity from 0.0 to 1.0,
			    strokeColor: 'blue', //stroke color,
			    strokeOpacity: 0.5 //opacity from 0.0 to 1.0
		});
			
		//Si el margen de error es mayor a 20
		if(parseInt(globales['accuracy'])>accuracy_min){
			if(navigator.notification){
				navigator.notification.alert(
				    'No es posible determinar una posici\xf3n precisa de su ubicaci\xf3n actual.',     // mensaje (message)
				    alertDismissed,         // funci?n 'callback' (alertCallback)
				    'Posici\xf3n no precisa',            // titulo (title)
				    'Cerrar'                // nombre del bot?n (buttonName)
				);
			}else{
	    		alert("No es posible determinar una precisa muy exacta de su ubicaci\xf3n actual.");
	    	}
	    	//set the zoom level to the circle's size
		    map.fitBounds(circle.getBounds());
	    }
	    
		
		intervalUpdateGasto=0;

			
			
	}
    
    
	// onError Callback receives a PositionError object
	//
	function onError(error) {
	    alert('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
	}
</script>

</head>

<body>


	<!-- Home -->
	<div data-role="page" data-transition="none"  id="home" style="height: 100%;" class="details-page" data-prefetch>
		<div data-role="content" class="sin-padding" style="height: 90%;" id="layer-mapa" data-theme="a">
            <div id="map_content">
                <div id="map_canvas" style="height: 100%;"></div>
            </div>
        </div>
	</div>


</body>

</html>